name: Next JS CI

# Controls when the workflow will run
on:
  workflow_call:
    inputs:
      runs_on:
        required: false
        type: string
        default: "ubuntu-latest"

permissions:
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout

jobs:
  ci:
    runs-on: ${{inputs.runs_on}} # We are using ubuntu to deploy flutter web
    timeout-minutes: 20
    steps:
      - name: Checkout
        uses: actions/checkout@main

      - name: Set Up Node.js
        uses: actions/setup-node@main
        with:
          node-version: ${{ vars.NODE_FRAMEWORK_VERSION }}
          cache: npm

      - name: üì¶ Install Dependencies
        # npm ci instead of npm install to not overwrite package_lock.json
        run: npm install

      - name: üîç Lint & Type Check
        run: |
          npm run lint --if-present
          npm run type-check --if-present
  notify:
    if: always() # Ensures this job runs regardless of the completion status of dependent jobs
    needs:
      - ci
    uses: ./.github/workflows/notification.yml
    secrets: inherit
    with:
      job_status: ${{ needs.ci.result }}
      workflow: ${{ github.workflow }}
      runs_on: ${{inputs.runs_on}}
      trigger_actor: ${{ github.actor }}
      pr_title: ${{ github.event.pull_request.title }}
