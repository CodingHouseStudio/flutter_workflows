name: Notify

on:
  workflow_call:
    inputs:
      job_status:
        required: true
        type: string
      workflow:
        required: true
        type: string
      dop_text:
        required: false
        type: string
        default: ""
      runs_on:
        required: false
        type: string
        default: "ubuntu-latest"
      trigger_actor:
        required: false
        type: string
        default: ""
      pr_title:
        required: false
        type: string
        default: ""

jobs:
  notification:
    timeout-minutes: 3
    runs-on: ${{ inputs.runs_on }}
    steps:
      - name: Send Telegram Notification
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            *${{ inputs.job_status == 'success' && 'âœ… Build Successful' || 'âŒ Build Failed' }}*

            ğŸ”¹ *Repo:* `${{ github.event.repository.name }}`
            ğŸ”¹ *Branch:* `${{ github.head_ref || github.ref_name }}`
            ğŸ”¹ *Workflow:* ${{ inputs.workflow }}
            ${{ inputs.trigger_actor != '' && format('ğŸ‘¤ *User:* {0}', inputs.trigger_actor) || '' }}
            ${{ inputs.pr_title != '' && format('ğŸ“ *PR Title:* {0}', inputs.pr_title) || '' }}

            ${{ inputs.dop_text != '' && format('_{0}_', inputs.dop_text) || '' }}

            [ğŸ”— View Run Logs](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
