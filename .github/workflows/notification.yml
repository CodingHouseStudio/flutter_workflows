name: Notify

on:
  workflow_call:
    inputs:
      job_status:
        required: true
        type: string
      workflow:
        required: true
        type: string
      dop_text:
        required: false
        type: string
        default: ""
      runs_on:
        required: false
        type: string
        default: "ubuntu-latest"
      trigger_actor:
        required: false
        type: string
        default: ""
      pr_title:
        required: false
        type: string
        default: ""

jobs:
  notification:
    timeout-minutes: 3
    runs-on: ${{ inputs.runs_on }}
    steps:
      - name: Notify on Success
        if: ${{ inputs.job_status == 'success' }}
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ | –¥–ª—è –±–∞–≥–∞—Ç–æ—Ä—è–¥–∫–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É
          message: |
            ${{ format('‚úÖ Build successful for {0} in repository {1}.{2}{3}{4}', 
              inputs.workflow, 
              github.event.repository.name, 
              inputs.trigger_actor != '' && format('%0Aüë§ User: {0}', inputs.trigger_actor) || '', 
              inputs.pr_title != '' && format('%0Aüìù Info: {0}', inputs.pr_title) || '', 
              inputs.dop_text != '' && format('%0A-------- {0}', inputs.dop_text) || ''
            ) }}

      - name: Notify on Failure
        if: ${{ inputs.job_status == 'failure' }}
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            ${{ format('‚ùå Build failed for {0} in repository {1}.{2}{3}{4}', 
              inputs.workflow, 
              github.event.repository.name, 
              inputs.trigger_actor != '' && format('%0Aüë§ User: {0}', inputs.trigger_actor) || '', 
              inputs.pr_title != '' && format('%0Aüìù Info: {0}', inputs.pr_title) || '', 
              inputs.dop_text != '' && format('%0A-------- {0}', inputs.dop_text) || ''
            ) }}
